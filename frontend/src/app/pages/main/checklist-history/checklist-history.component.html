<div class="checklist-history-container">
  <h1>Historial de Checklists</h1>
  <p class="subtitle">Historial completo de checklists de entrada y salida de turno del equipo</p>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando historial...</p>
  </div>

  <div *ngIf="!isLoading && checks.length === 0" class="empty-state">
    <mat-icon>assignment</mat-icon>
    <p>No hay checklists registrados a√∫n</p>
  </div>

  <div *ngIf="!isLoading && checks.length > 0">
    <div class="summary-info">
      <mat-icon>info</mat-icon>
      <span>Total de checklists: <strong>{{ totalChecks }}</strong></span>
    </div>

    <mat-accordion multi>
      <mat-expansion-panel *ngFor="let check of checks" [expanded]="isExpanded(check._id)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <div class="check-header">
              <div class="check-title">
                <mat-icon [class]="check.hasRedServices ? 'status-error' : 'status-ok'">
                  {{ check.hasRedServices ? 'error' : 'check_circle' }}
                </mat-icon>
                <span class="check-type">{{ getCheckTypeLabel(check.type) }}</span>
                <span class="check-date">{{ check.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="check-info">
                <span class="checklist-name">{{ check.checklistName || 'Checklist' }}</span>
                <span class="user-name">por {{ getUserDisplay(check) }}</span>
              </div>
            </div>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="check-details">
          <div class="status-summary">
            <div class="status-card" [class]="check.hasRedServices ? 'status-error' : 'status-ok'">
              <mat-icon>assessment</mat-icon>
              <div>
                <h3>Estado General</h3>
                <p class="status-value">{{ check.hasRedServices ? 'CON PROBLEMAS' : 'OK' }}</p>
              </div>
            </div>

            <div class="status-card">
              <mat-icon>list_alt</mat-icon>
              <div>
                <h3>Servicios Evaluados</h3>
                <p class="status-value">{{ check.services.length }}</p>
              </div>
            </div>

            <div class="status-card" *ngIf="getServicesWithIssues(check) > 0">
              <mat-icon>report_problem</mat-icon>
              <div>
                <h3>Servicios con Problemas</h3>
                <p class="status-value">{{ getServicesWithIssues(check) }}</p>
              </div>
            </div>
          </div>

          <mat-divider></mat-divider>

          <h3 class="section-title">
            <mat-icon>list</mat-icon>
            Detalle de Servicios
          </h3>

          <div class="services-list">
            <div *ngFor="let service of check.services" class="service-item" [class]="getStatusColor(service.status)">
              <div class="service-header">
                <mat-icon class="service-status-icon">
                  {{ service.status === 'verde' ? 'check_circle' : 'error' }}
                </mat-icon>
                <span class="service-title">{{ service.serviceTitle }}</span>
                <span class="service-status-badge" [class]="getStatusColor(service.status)">
                  {{ service.status | uppercase }}
                </span>
              </div>
              <div *ngIf="service.observation" class="service-observation">
                <mat-icon>comment</mat-icon>
                <p>{{ service.observation }}</p>
              </div>
            </div>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <mat-paginator
      [length]="totalChecks"
      [pageSize]="limit"
      [pageIndex]="currentPage - 1"
      (page)="goToPage($event.pageIndex + 1)"
      [hidePageSize]="true"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div>
